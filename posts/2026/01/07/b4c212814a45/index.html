<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>泛型工厂应用改进尝试（一） | 我与岁月的森林的博客</title><meta name="author" content="我与岁月的森林"><meta name="copyright" content="我与岁月的森林"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="实验声明调用者的产品只要满足以下两个条件即可通过该工厂生产食物: 1.要求食物都继承自Food抽象类 2.无参构造方法公开(如果没有单独声明构造方法，默认为公开的无参构造) 术语 分步制作流程：将一个方法的逻辑拆分为多个方法，并且给每一个方法都加上唯一的访问锁。  静态存储：利用静态的存储结构来对数据进行存储。  中间处理逻辑：对静态存储结构的处理，判断当前类型是否存在于静态存储结构中，不存在则创">
<meta property="og:type" content="article">
<meta property="og:title" content="泛型工厂应用改进尝试（一）">
<meta property="og:url" content="https://jokevallen.github.io/posts/2026/01/07/b4c212814a45/index.html">
<meta property="og:site_name" content="我与岁月的森林的博客">
<meta property="og:description" content="实验声明调用者的产品只要满足以下两个条件即可通过该工厂生产食物: 1.要求食物都继承自Food抽象类 2.无参构造方法公开(如果没有单独声明构造方法，默认为公开的无参构造) 术语 分步制作流程：将一个方法的逻辑拆分为多个方法，并且给每一个方法都加上唯一的访问锁。  静态存储：利用静态的存储结构来对数据进行存储。  中间处理逻辑：对静态存储结构的处理，判断当前类型是否存在于静态存储结构中，不存在则创">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jokevallen.github.io/images/head.png">
<meta property="article:published_time" content="2026-01-07T10:00:56.000Z">
<meta property="article:modified_time" content="2026-01-07T13:49:55.237Z">
<meta property="article:author" content="我与岁月的森林">
<meta property="article:tag" content="C#">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jokevallen.github.io/images/head.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "泛型工厂应用改进尝试（一）",
  "url": "https://jokevallen.github.io/posts/2026/01/07/b4c212814a45/",
  "image": "https://jokevallen.github.io/images/head.png",
  "datePublished": "2026-01-07T10:00:56.000Z",
  "dateModified": "2026-01-07T13:49:55.237Z",
  "author": [
    {
      "@type": "Person",
      "name": "我与岁月的森林",
      "url": "https://jokevallen.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://jokevallen.github.io/posts/2026/01/07/b4c212814a45/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/xml/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '泛型工厂应用改进尝试（一）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom_bilibili.css"><link rel="stylesheet" href="/css/custom_table.css"><meta name="generator" content="Hexo 8.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/images/logo_light.png" alt="Logo"></a><a class="nav-page-title" href="/"><span class="site-name">泛型工厂应用改进尝试（一）</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">泛型工厂应用改进尝试（一）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon fas fa-history"></i><span class="post-meta-label">更新于</span><time datetime="2026-01-07T13:49:55.237Z" title="更新于 2026-01-07 21:49:55">2026-01-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AA%E4%BA%BA%E7%A0%94%E7%A9%B6/">个人研究</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h2 id="实验声明"><a href="#实验声明" class="headerlink" title="实验声明"></a>实验声明</h2><p>调用者的产品只要满足以下两个条件即可通过该工厂生产食物:</p>
<p>1.要求食物都继承自Food抽象类</p>
<p>2.无参构造方法公开(如果没有单独声明构造方法，默认为公开的无参构造)</p>
<h3 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h3><ul>
<li><p>分步制作流程：将一个方法的逻辑拆分为多个方法，并且给每一个方法都加上唯一的访问锁。</p>
</li>
<li><p>静态存储：利用静态的存储结构来对数据进行存储。</p>
</li>
<li><p>中间处理逻辑：对静态存储结构的处理，判断当前类型是否存在于静态存储结构中，不存在则创建，使用静态存储就必须使用中间处理逻辑，不使用静态存储则不需要使用中间处理逻辑。</p>
</li>
</ul>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>通过DateTime.Now获取方法执行的开始时间和结束时间，然后两个时间差值单位精确到毫秒。单线程数值保留4位小数，要求每执行一个线程休眠100毫秒，获取11个单线程执行的总计耗时算作一组数据，共获取20组数据，测试2次；多线程数值不保留小数，多线程共计12线程，要求多线程并发执行，不存在线程休眠，获取11个线程全部执行完成的总计耗时算作一组数据，共获取20组数据，测试2次，其它多线程并发测试类似。（之所以不统计12个线程是因为第一个执行的线程包含了C#文件的编译耗时，所以只统计第二个到最后一个，共计11个线程）</p>
<h3 id="计算方式"><a href="#计算方式" class="headerlink" title="计算方式"></a>计算方式</h3><p>（设20组数据分别为a1,a2,a3,…,a20，线程数11）：</p>
<p>线程平均耗时&#x3D;(a1&#x2F;11+a2&#x2F;11+a3&#x2F;11+…+a20&#x2F;11)&#x2F;20（保留4位小数）</p>
<h2 id="实验过程、分析及结果"><a href="#实验过程、分析及结果" class="headerlink" title="实验过程、分析及结果"></a>实验过程、分析及结果</h2><p>这种泛型工厂存在两个问题，第一它是通过反射来调用构造方法，所以速度非常慢，第二由于存在对公共资源的读取，所以要考虑资源冲突。</p>
<p>第一个问题如果想要改进，可以创建两个静态存储结构用于存储已经调用过至少一次的对应类型的构造方法信息以及这种食物类型，当再生产同一类型食物时就不需要再去通过反射查找构造信息了，而是直接从静态存储结构中查找，这种方法也算是牺牲存储来换取速度吧，类似于一种缓存思想吧。</p>
<p>第二个问题，我们需要访问的公共资源就是为了解决第一个问题的静态存储结构，当多个线程中都调用工厂生产食品时，都会使用到这个静态存储结构，就会存在资源冲突，所以必须对资源加锁访问，但是这么做又会导致我们生产食品时每一个产品都需要等前面的产品完全生产完成后才能进入生产过程，而不能够多线程并发生产，这就违背工厂的本质了。</p>
<p>为了解决第二个问题，我认为可以将制作流程中的逻辑进行进一步划分，划分为几个有序的方法，而我们需要保证每一个方法都有对应的锁，例如食物的制作流程有获取原材料、生产食物、包装食物，那么我们可以把整个流程分为三个流程，然后分别加上唯一的访问锁。</p>
<p>现在有线程A，B，C，D，E，F六个线程分别制作奶黄面包、夹层饼干、青柠薯片、吐司面包、草莓饼干、香辣薯片，制作流程按顺序分别是M1（获取原材料），M2（生产食物），M3（包装食物）。</p>
<p>三种食物采用一条生产线明显不太理想，我们可以给每种食物制订一条生产线，面包为L1，饼干为L2，薯片为L3（三个生产线的工作都可以概括为M1+M2+M3）。A和D都生产面包所以使用L1生产线，B和E都生产饼干所以使用L2生产线，C和F都生产薯片所以使用L3生产线。</p>
<h3 id="思路1"><a href="#思路1" class="headerlink" title="思路1"></a>思路1</h3><p>首先假设A进入L1生产线，获取M1的锁执行M1时,D需要等待A执行完M1+M2+M3才能开始生产；</p>
<p>B进入了L2生产线，获取了M1的锁执行M1，E需要等待B执行完M1+M2+M3才能开始生产；</p>
<p>C进入L3生产线，获取了M1的锁执行M1，F需要等待C执行完M1+M2+M3才能开始生产。</p>
<p>根据思路1，我进行了对比测试和简单测试，接下来我们一起看看实验结果吧。</p>
<p>（请查看测试表中的对比测试，对比测试比较单线程下反射和直接new对象的耗时）</p>
<p>要求启动12个线程，不使用分步制作流程，不使用静态存储，无中间处理逻辑，通过对比测试可知：</p>
<p>发现单线程执行耗时：约0.02236ms</p>
<p>多线程并发执行耗时：约36.2273ms</p>
<p>单线程直接new对象耗时:约0.0019ms</p>
<p><strong>结论1：</strong> 从上述结果我们可以发现单线程下反射的速率相比直接new对象慢了约10.77倍。</p>
<p>虽然通过反射让我们的工厂更加多态也更加接近面向对象，但是单纯使用反射在面对多线程时会带来巨大的性能开销。我们发现反射的效率比较低，参考了网上的资料发现，可以采用静态存储的方式来将类型信和构造器信息存储下来，下一次创建对象时就不需要通过反射查找而是直接根据静态存储中的生产资料创建对象即可，所以来验证一下这个方法是否有效？如果有效，它相对直接反射能提高多少速率呢？</p>
<p>（请查看测试表中的简单测试，简单测试比较单线程下直接使用反射和使用静态存储的耗时）</p>
<p>要求启动5个线程，不使用分步制作流程，使用静态存储，有中间处理逻辑，通过简单测试可知：</p>
<p><strong>结论2：</strong> 单线程下，使用静态存储比直接使用反射（无中间处理逻辑）的速率慢约7.3%，使用静态存储比直接使用反射（有中间处理逻辑）的速率快约26.4%。</p>
<p>这个结果出乎了我的意料，我的预测是使用静态存储会更快一些，但是实验结果却大相径庭。出现这个结果的原因是因为中间处理逻辑导致的，那我们应该怎么弥补中间处理逻辑所带来的时间消耗呢？我们可以尝试从对象的生产过程考虑，思路1要求我们必须按照顺序（M1-M2-M3）生产出一个食物后才能开始生产下一个食物，这就使得所有线程必须有序地一个一个进行生产，但是我们知道，一个食物大致可以分为M1-M2-M3三个生产过程，当一个食物进入M2或M3时，为了提高速率我们可以让下一个待制作的食物进入M1这个生产流程，这样可以使得资源的利用率提升，那应该怎么做呢？我们可以尝试将M1-M2-M3放在一个方法中，然后给每一个制作流程加上一个访问锁，这样多线程访问时，既能保证制作流程顺序又能够并发执行提高效率，这就是分步制作流程，所以实验思路就变成了思路2。</p>
<h3 id="思路2"><a href="#思路2" class="headerlink" title="思路2"></a>思路2</h3><p>首先假设A进入L1生产线，获取M1的锁执行M1，当A执行完M1获取M2的锁执行M2时,D进入L1生产线获取M1的锁执行M1；</p>
<p>B进入了L2生产线，获取M1的锁执行M1，当B执行完M1获取M2的锁执行M2时,E进入L2生产线获取M1的锁执行M1；</p>
<p>C进入L3生产线，获取M1的锁执行M1，当C执行完M1获取M2的锁执行M2时,F进入L3生产线获取M1的锁执行M1。</p>
<p>那么思路2是否有效？如果有效能提高多少速率？</p>
<p>（请查看测试表中的对比测试2，对比测试2对比是否使用分步制作流程和是否使用静态存储）</p>
<p>①启动12线程，使用分步制作流程，使用静态存储，有中间处理逻辑</p>
<p>②启动12线程，使用分步制作流程，不使用静态存储，有中间处理逻辑</p>
<p>③启动12线程，不使用分步制作流程，使用静态存储，有中间处理逻辑</p>
<p>④启动12线程，使用分步制作流程，不使用静态存储，无中间处理逻辑</p>
<p>⑤启动12线程，不使用分步制作流程，不使用静态存储，无中间处理逻辑</p>
<p>⑥启动12线程，不使用分步制作流程，不使用静态存储，有中间处理逻辑</p>
<p>原则上我们应该是有8组方案，但是有两组不符合专设术语中的要求，所以进行了舍弃，通过对比测试2，得出以下结果：</p>
<p>发现单线程执行耗时：⑤&lt;④&lt;①&lt;②&lt;③≈⑥</p>
<p>多线程并发执行耗时：④&lt;①&lt;⑤≈②&lt;⑥≈③</p>
<p>说明一下，②⑥可以不使用中间处理逻辑，但是为了遵循控制变量唯一的原则加入了中间处理逻辑。</p>
<p><strong>结论3：</strong> 通过比较①②可以发现，单线程中使用静态存储比不使用静态存储提升约44.7%的速率，而多线程并发执行中使用静态存储相比不使用静态存储提升约6.6%。</p>
<p><strong>结论4：</strong> 通过比较①③可以发现，单线程中使用分步制作流程比不使用分步制作流程提升约75.1%的速率，而多线程并发执行时我们发现使用分步制作流程相比不使用分步制作流程提升约34.4%的速率。</p>
<p><strong>结论5：</strong> ⑤才是真正意义上的直接调用反射，因为反射并不需要中间处理逻辑，而④对⑤进行了优化，加入了分步制作流程，在多线程并发执行中使用分步制作流程使得④在⑤的基础上提升约29.3%的速率，但是在单线程中⑤比④更快速，结合结论4可以说明分步制作流程适用于有静态存储或者无静态存储多线程并发执行的情况。</p>
<p><strong>结论6：</strong> 对比⑤⑥可以发现中间处理逻辑对执行速率的影响，中间处理逻辑必然会使得执行速率降低，但是我们还是有必要知道它的影响程度，⑥在⑤的基础上加入了中间处理逻辑导致单线程下速率降低98.7%，多线程并发执行速率降低约26.4%，这说明中间处理逻辑非常影响速率，但是对于静态存储而言，中间处理逻辑是必不可少的，所以我们只能尝试优化而不可能禁用。</p>
<p><strong>结论7：</strong> 对比③⑥可以发现，当单独使用静态存储而不使用分步制作流程时，无论是单线程还是多线程并发执行的情况，都无法提升速率，结合结论1说明静态存储需要结合分步制作流程才能提升速率。</p>
<p>结合结论5和结论7可知在能够提升速率的情况下，分步制作流程是静态存储的必要不充分条件。再根据前几次测试的结果可以看出，12个线程抢一把锁完成A方法比12个线程抢三把锁分步完成A方法的三个部分速率更慢，也就是说分步制作流程的想法还是能够提升一定速率的，而静态存储在处理多线程时并不能够有效提升速率，因为静态存储是涉及对存储结构的遍历查找的，随着存储结构存储的数据越多，就会变得越慢，最后总会低于直接使用反射的速率，唯一能够优化的或许只能从存储结构和相关的查找算法两个角度去考虑了。我猜测分步制作流程对速率的提升程度会随着锁的数量增多或中间处理逻辑变得复杂而降低，不过这需要我进一步测试验证，接下来我们尝试对存储结构进行优化。</p>
<p>（请查看测试表中的对比测试3，对比测试3对比是否使用分步制作流程）</p>
<p>①启动12线程，使用分步制作流程，使用静态存储，有中间处理逻辑</p>
<p>②启动12线程，不使用分步制作流程，使用静态存储，有中间处理逻辑</p>
<p>在对比测试3中，我对静态存储结构进行了自定义，进而简化了中间的一些判断过程，幸运的是这确实得到了进一步优化，测试结果如下：</p>
<p><strong>结论8：</strong> 同在对比测试3中，单线程使用分步制作流程相比不使用提升约57.1%的速率，多线程并发执行中使用分步制作流程相比不使用提升约9.9%的速率。</p>
<p><strong>结论9：</strong> 与对比测试2中的①相比较，单线程中对比测试3中①的速率提升约36.2%，多线程并发执行中对比测试3中①的速率提升约27.0%。</p>
<p><strong>结论10：</strong> 与对比测试2中的⑤相比较，单线程中对比测试3中①的速率提升约18.3%，多线程并发执行中对比测试3中①的速率提升约31.5%。</p>
<p>结论9说明自定义的静态存储结构比双列表更适合我们的工厂，结论10说明我们成功通过分步制作流程和自定义静态存储结构的方式弥补了中间处理逻辑所带来的时间消耗，并且在此基础上还提升了一定速率，使得当前的模式比直接调用反射更快。字典作为静态存储结构也是一个不错的选择，那我们一起看看字典和我们自定义的结构相比哪一个更适合我们的工厂吧。</p>
<p>（请查看测试表中的对比测试4，对比测试4对比使用字典和自定义存储结构）</p>
<p>①启动3线程，使用分步制作流程，使用静态存储，有中间处理逻辑，静态存储结构为Dictionary</p>
<p>②启动3线程，使用分步制作流程，使用静态存储，有中间处理逻辑，静态存储结构为自定义存储结构</p>
<p>③启动6线程，使用分步制作流程，使用静态存储，有中间处理逻辑，静态存储结构为Dictionary</p>
<p>④启动6线程，使用分步制作流程，使用静态存储，有中间处理逻辑，静态存储结构为自定义存储结构</p>
<p>⑤启动12线程，使用分步制作流程，使用静态存储，有中间处理逻辑，静态存储结构为Dictionary</p>
<p>⑥启动12线程，使用分步制作流程，使用静态存储，有中间处理逻辑，静态存储结构为自定义存储结构</p>
<p>在对比测试4中，我们除了对比静态存储结构，也对启动的线程数进行了改变，通过对比测试4我们可以得出以下结果：</p>
<p>发现单线程执行耗时：⑥&lt;⑤&lt;④&lt;③&lt;②&lt;①</p>
<p>多线程并发执行耗时：②&lt;④&lt;①&lt;③&lt;⑥&lt;⑤</p>
<p><strong>结论11：</strong> 我们发现单线程执行耗时呈现出一个规律，线程数越多，单线程执行耗时越少。</p>
<p>这是因为静态存储在每次加入一个新的元素时都会耗费一定时间，所以平均耗时&#x3D;（新元素存储时间+旧元素读取时间）&#x2F; 线程数，旧元素读取时间是很短的，相对新元素存储时间可以忽略不计，新元素存储时间与静态存储结构有关，可以对比①③⑤或②④⑥，所以才会呈现出结论11所述的规律。</p>
<p><strong>结论12：</strong> 通过对比①②或③④或⑤⑥可知，自定义存储结构相比字典更适合我们的工厂。</p>
<p>根据对比测试3和对比测试4我们发现自定义的静态存储结构相比双列表和字典更适合我们的工厂，再结合前几次测试说明通过结合分步制作流程、静态存储和自定义存储结构，我们当前的模式已经比直接调用反射更快了，虽然我们的优化方法对速率的提升不是极大幅度的，但是这可以看作是一个小小的进步。所以我们获得了目前最优的版本，具体代码请查看对应文件“泛型工厂应用改进尝试代码”。</p>
<h2 id="实验总结"><a href="#实验总结" class="headerlink" title="实验总结"></a>实验总结</h2><p>这个实验并不是去改进工厂模式，而应该是看作一种对工厂模式应用的优化，实验中我们通过分步制作流程、静态存储、自定义静态存储结构三种方式尝试对泛型工厂的应用进行优化，其中我们从单线程、多线程等方面对改进后的泛型工厂进行了测试，根据测试数据得出相关结论，实验中将优化思路和测试数据结合，一步一步地将实验的逻辑贯通起来，使得实验的操作井然有序，实验过程中对测试数据进行了筛选，并且将求取的平均值作为最终值，遵循控制变量单一的原则对比测试数据，计算各优化方式所提升的速率百分比。</p>
<h3 id="不足之处"><a href="#不足之处" class="headerlink" title="不足之处"></a>不足之处</h3><p>①本次实验采用的测试方式是手动测试，所以效率比较低，建议编写一套自动化测试工具。</p>
<p>②本次实验中对于测试数据的筛选规则比较粗略，建议借鉴一些科学的实验数据筛选规则。</p>
<p>③本次实验中各个测试的代码文件命名以及代码编写不规范，建议每一个测试都创建一个新的代码文件并制定代码编写规范。</p>
<h3 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h3><img src="/posts/2026/01/07/b4c212814a45/img1.jpeg" class="" width="825" height="722">

<h2 id="实验数据"><a href="#实验数据" class="headerlink" title="实验数据"></a>实验数据</h2><h3 id="对比测试"><a href="#对比测试" class="headerlink" title="对比测试"></a>对比测试</h3><div class="custom-table-container">
    <table class="custom-table">
        <thead>
            <tr>
                <th>分类</th>
                <th>线程数</th>
                <th>分步制作流程</th>
                <th>静态存储</th>
                <th>中间处理逻辑</th>
                <th>静态存储结构</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td rowspan="3" class="custom-table-category">测试1</td>
                <td>12</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td>无</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.2473/11+0.2514/11+0.2251/11+0.2452/11+0.2544/11+0.1931/11+0.248/11+0.2527/11+0.2284/11+0.2871/11+0.2323/11+0.2368/11+0.2104/11+0.1991/11+0.2969/11+0.2088/11+0.2958/11+0.2857/11+0.2179/11+0.3030/11)/20 ≈ 0.02236ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (356/11+353/11+369/11+473/11+382/11+474/11+443/11+405/11+376/11+383/11+402/11+367/11+402/11+385/11+382/11+395/11+424/11+402/11+409/11+388/11)/20 ≈ 36.2273ms
                </td>
            </tr>
            <tr>
                <td rowspan="2" class="custom-table-category">测试2</td>
                <td>12</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">√</td>
                <td>无</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.5067/11+0.4547/11+0.4635/11+0.4335/11+0.4951/11+0.4383/11+0.5566/11+0.5493/11+0.4451/11+0.4577/11+0.4205/11+0.4856/11+0.5487/11+0.4462/11+0.4429/11+0.4718/11+0.5608/11+0.4172/11+0.4573/11+0.546/11)/20 ≈ 0.04362ms
                </td>
            </tr>
            <tr>
                <td rowspan="2" class="custom-table-category">直接new对象</td>
                <td>1</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td>无</td>
            </tr>
            <tr>
                <td colspan="4" class="custom-table-formula">
                    (0.0017+0.002+0.0015+0.0018+0.0026+0.0018+0.0018+0.002+0.0022+0.0018+0.0019+0.0021+0.0017+0.0017+0.0018+0.002+0.0026+0.002+0.0017+0.0021)/20 ≈ 0.0019ms
                </td>
            </tr>
        </tbody>
    </table>
</div>

<h3 id="对比测试2"><a href="#对比测试2" class="headerlink" title="对比测试2"></a>对比测试2</h3><div class="custom-table-container">
    <table class="custom-table">
        <thead>
            <tr>
                <th>分类</th>
                <th>线程数</th>
                <th>分步制作流程</th>
                <th>静态存储</th>
                <th>中间处理逻辑</th>
                <th>静态存储结构</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td rowspan="3" class="custom-table-category">测试1</td>
                <td>12</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>List&ltType&gt<br>List&ltConstructorInfo&gt</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.2630/11+0.2468/11+0.2430/11+0.2587/11+0.2437/11+0.2682/11+0.2648/11+0.3433/11+0.3038/11+0.3020/11+0.2680/11+0.2681/11+0.2528/11+0.2510/11+0.2504/11+0.3048/11+0.2898/11+0.2856/11+0.2640/11+0.2785/11)/20 ≈ 0.02477ms
                    (0.2693/11+0.2842/11+0.2505/11+0.2595/11+0.2602/11+0.2629/11+0.2703/11+0.2734/11+0.2709/11+0.2729/11+0.3121/11+0.2894/11+0.2496/11+0.2532/11+0.3189/11+0.2733/11+0.2537/11+0.2820/11+0.2614/11+0.2532/11)/20 ≈ 0.02464ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (194/11+166/11+180/11+211/11+192/11+188/11+189/11+195/11+200/11+209/11+178/11+167/11+207/11+214/11+188/11+193/11+214/11+166/11+213/11+201/11)/20 ≈ 17.5682ms
                    (197/11+215/11+208/11+186/11+204/11+209/11+212/11+188/11+206/11+181/11+188/11+194/11+186/11+189/11+212/11+194/11+192/11+188/11+191/11+167/11)/20 ≈ 17.7591ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试2</td>
                <td>12</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">√</td>
                <td>无</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.3962/11+0.4001/11+0.4079/11+0.3890/11+0.4202/11+0.3827/11+0.4235/11+0.4130/11+0.3975/11+0.3919/11+0.4119/11+0.3824/11+0.3859/11+0.3770/11+0.3767/11+0.3933/11+0.3854/11+0.3875/11+0.3833/11+0.3847/11)/20 ≈ 0.03586ms
                    (0.4340/11+0.3873/11+0.3839/11+0.3800/11+0.4076/11+0.3882/11+0.3836/11+0.3853/11+0.4005/11+0.3831/11+0.3870/11+0.3805/11+0.3851/11+0.3887/11+0.3875/11+0.3986/11+0.4298/11+0.3871/11+0.3718/11+0.3918/11)/20 ≈ 0.03564ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (181/11+171/11+212/11+173/11+210/11+229/11+239/11+195/11+238/11+213/11+258/11+155/11+239/11+181/11+215/11+226/11+184/11+199/11+179/11+224/11)/20 ≈ 18.7318ms
                    (179/11+195/11+216/11+237/11+200/11+222/11+199/11+209/11+241/11+240/11+236/11+173/11+243/11+198/11+210/11+218/11+153/11+212/11+184/11+200/11)/20 ≈ 18.9318ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试3</td>
                <td>12</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>List&ltType&gt<br>List&ltConstructorInfo&gt</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.4438/11+0.4097/11+0.4702/11+0.5337/11+0.5064/11+0.4992/11+0.5202/11+0.4406/11+0.5306/11+0.4278/11+0.4877/11+0.4401/11+0.4657/11+0.4190/11+0.4321/11+0.4535/11+0.5456/11+0.4587/11+0.4653/11+0.5339/11)/20 ≈ 0.04310ms
                    (0.4450/11+0.4828/11+0.4320/11+0.5183/11+0.4642/11+0.4664/11+0.5300/11+0.4376/11+0.5262/11+0.4368/11+0.4956/11+0.4988/11+0.4617/11+0.4656/11+0.4638/11+0.5258/11+0.4161/11+0.4754/11+0.5085/11+0.5026/11)/20 ≈ 0.04342ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (234/11+256/11+267/11+250/11+233/11+228/11+248/11+255/11+259/11+221/11+243/11+261/11+245/11+263/11+259/11+300/11+265/11+277/11+240/11+326/11)/20 ≈ 23.3182ms
                    (276/11+260/11+334/11+281/11+259/11+262/11+328/11+279/11+247/11+248/11+264/11+284/11+251/11+260/11+267/11+235/11+243/11+238/11+253/11+245/11)/20 ≈ 24.1545ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试4</td>
                <td>12</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td>无</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.2384/11+0.2295/11+0.2178/11+0.2000/11+0.2438/11+0.2175/11+0.2378/11+0.2339/11+0.2340/11+0.2694/11+0.2605/11+0.2767/11+0.2464/11+0.2113/11+0.2838/11+0.2668/11+0.2412/11+0.2335/11+0.2805/11+0.3166/11)/20 ≈ 0.02245ms
                    (0.2524/11+0.2246/11+0.2139/11+0.2437/11+0.2667/11+0.3445/11+0.2296/11+0.2475/11+0.2808/11+0.2380/11+0.2095/11+0.2219/11+0.2885/11+0.2187/11+0.2372/11+0.2984/11+0.2734/11+0.2104/11+0.3401/11+0.2183/11)/20 ≈ 0.02299ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (141/11+143/11+160/11+143/11+164/11+170/11+177/11+166/11+179/11+159/11+159/11+178/11+163/11+148/11+131/11+156/11+160/11+145/11+149/11+167/11)/20 ≈ 14.3545ms
                    (159/11+136/11+146/11+139/11+144/11+121/11+154/11+145/11+178/11+164/11+147/11+137/11+133/11+175/11+150/11+170/11+159/11+166/11+173/11+166/11)/20 ≈ 13.9182ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试5</td>
                <td>12</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td>无</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.2051/11+0.2230/11+0.2466/11+0.2221/11+0.2142/11+0.2485/11+0.2797/11+0.2225/11+0.2487/11+0.2746/11+0.2476/11+0.2384/11+0.2052/11+0.2497/11+0.2496/11+0.2066/11+0.1999/11+0.2692/11+0.1951/11+0.2110/11)/20 ≈ 0.02116ms
                    (0.2636/11+0.2345/11+0.2293/11+0.2750/11+0.2286/11+0.2743/11+0.2408/11+0.2233/11+0.2744/11+0.2332/11+0.2374/11+0.2537/11+0.2271/11+0.2208/11+0.2023/11+0.2841/11+0.2675/11+0.1943/11+0.2031/11+0.2189/11)/20 ≈ 0.02176ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (183/11+189/11+200/11+201/11+165/11+212/11+212/11+214/11+192/11+200/11+209/11+213/11+188/11+230/11+226/11+213/11+233/11+193/11+175/11+225/11)/20 ≈ 18.5136ms
                    (208/11+195/11+189/11+211/11+204/11+172/11+205/11+203/11+185/11+201/11+194/11+195/11+183/11+190/11+206/11+221/11+198/11+219/11+173/11+220/11)/20 ≈ 18.0545ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试6</td>
                <td>12</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">√</td>
                <td>无</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.4733/11+0.5501/11+0.4496/11+0.4663/11+0.4831/11+0.5367/11+0.5336/11+0.4518/11+0.4509/11+0.5200/11+0.4885/11+0.4548/11+0.4147/11+0.4541/11+0.5479/11+0.4550/11+0.4590/11+0.4903/11+0.4512/11+0.4614/11)/20 ≈ 0.04360ms
                    (0.4116/11+0.4936/11+0.4380/11+0.4129/11+0.4700/11+0.4814/11+0.4380/11+0.4606/11+0.3962/11+0.5373/11+0.4038/11+0.4558/11+0.4678/11+0.4151/11+0.4474/11+0.4822/11+0.5452/11+0.4627/11+0.4175/11+0.5360/11)/20 ≈ 0.04170ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (257/11+271/11+245/11+234/11+257/11+288/11+253/11+269/11+246/11+249/11+301/11+250/11+196/11+247/11+264/11+251/11+227/11+258/11+265/11+251/11)/20 ≈ 23.0864ms
                    (254/11+243/11+288/11+270/11+262/11+248/11+253/11+272/11+229/11+254/11+237/11+265/11+263/11+229/11+258/11+261/11+230/11+279/11+259/11+234/11)/20 ≈ 23.1273ms
                </td>
            </tr>
        </tbody>
    </table>
</div>

<h3 id="简单测试"><a href="#简单测试" class="headerlink" title="简单测试"></a>简单测试</h3><div class="custom-table-container">
    <table class="custom-table">
        <thead>
            <tr>
                <th>分类</th>
                <th>线程数</th>
                <th>分步制作流程</th>
                <th>静态存储</th>
                <th>中间处理逻辑</th>
                <th>静态存储结构</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td rowspan="2" class="custom-table-category">测试1</td>
                <td>5</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td>无</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.007200/1+0.007300/1+0.009700/1+0.007300/1+0.006400/1+0.007100/1+0.007900/1+0.007100/1+0.008100/1+0.007600/1+0.009900/1+0.007000/1+0.007200/1+0.008900/1+0.008300/1+0.007500/1+0.008300/1+0.007700/1+0.007800/1+0.008800/1)/20 ≈ 0.007855ms
                    (0.007200/1+0.007400/1+0.007100/1+0.006900/1+0.006400/1+0.007100/1+0.006700/1+0.008500/1+0.008200/1+0.007400/1+0.009300/1+0.007300/1+0.007400/1+0.006500/1+0.007400/1+0.007000/1+0.009000/1+0.008700/1+0.006100/1+0.006600/1)/20 ≈ 0.007410ms
                </td>
            </tr>
            <tr>
                <td rowspan="2" class="custom-table-category">测试2</td>
                <td>5</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">√</td>
                <td>无</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.009700/1+0.009400/1+0.009400/1+0.010100/1+0.010000/1+0.010000/1+0.013100/1+0.013700/1+0.010200/1+0.010100/1+0.010500/1+0.009900/1+0.010700/1+0.009900/1+0.009900/1+0.009600/1+0.010400/1+0.010000/1+0.015600/1+0.010600/1)/20 ≈ 0.010640ms
                    (0.010000/1+0.009500/1+0.010800/1+0.011600/1+0.009700/1+0.010100/1+0.009700/1+0.009500/1+0.010300/1+0.013100/1+0.011300/1+0.009300/1+0.008900/1+0.008800/1+0.010900/1+0.009900/1+0.009200/1+0.009400/1+0.009300/1+0.009900/1)/20 ≈ 0.010060ms
                </td>
            </tr>
            <tr>
                <td rowspan="2" class="custom-table-category">测试3</td>
                <td>5</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>List&ltType&gt<br>List&ltConstructorInfo&gt</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.007700/1+0.008400/1+0.008300/1+0.007400/1+0.007500/1+0.009500/1+0.008400/1+0.007400/1+0.008300/1+0.007700/1+0.007300/1+0.008000/1+0.008400/1+0.008200/1+0.008200/1+0.008300/1+0.009400/1+0.008000/1+0.008200/1+0.008200/1)/20 ≈ 0.008140ms
                    (0.007900/1+0.007400/1+0.009600/1+0.008400/1+0.009000/1+0.007800/1+0.007100/1+0.008100/1+0.007800/1+0.009600/1+0.009000/1+0.007700/1+0.008900/1+0.008100/1+0.008300/1+0.007400/1+0.008100/1+0.008200/1+0.008400/1+0.008000/1)/20 ≈ 0.008240ms
                </td>
            </tr>
        </tbody>
    </table>
</div>

<h3 id="对比测试3"><a href="#对比测试3" class="headerlink" title="对比测试3"></a>对比测试3</h3><div class="custom-table-container">
    <table class="custom-table">
        <thead>
            <tr>
                <th>分类</th>
                <th>线程数</th>
                <th>分步制作流程</th>
                <th>静态存储</th>
                <th>中间处理逻辑</th>
                <th>静态存储结构</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td rowspan="3" class="custom-table-category">测试1</td>
                <td>12</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>CustomStructs</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.1810/11+0.2175/11+0.2126/11+0.2066/11+0.2100/11+0.2342/11+0.1962/11+0.1825/11+0.1835/11+0.1835/11+0.1828/11+0.2141/11+0.1865/11+0.2178/11+0.1873/11+0.1740/11+0.1936/11+0.1996/11+0.2277/11+0.2215/11)/20 ≈ 0.01824ms (0.1822/11+0.2286/11+0.1970/11+0.1848/11+0.2127/11+0.2282/11+0.1951/11+0.2149/11+0.1884/11+0.1911/11+0.1861/11+0.1829/11+0.1990/11+0.2022/11+0.1862/11+0.2175/11+0.1809/11+0.1792/11+0.2209/11+0.1909/11)/20 ≈ 0.01804ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (170/11+151/11+152/11+113/11+169/11+149/11+114/11+140/11+136/11+174/11+147/11+160/11+178/11+160/11+155/11+101/11+178/11+165/11+174/11+153/11)/20 ≈ 13.8136ms (149/11+169/11+145/11+156/11+118/11+138/11+168/11+165/11+175/11+150/11+136/11+138/11+157/11+175/11+158/11+122/11+162/11+142/11+197/11+160/11)/20 ≈ 14.0000ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试2</td>
                <td>12</td>
                <td class="custom-table-cross">×</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>CustomStructs</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.3074/11+0.3424/11+0.3201/11+0.2986/11+0.2934/11+0.3014/11+0.3034/11+0.3018/11+0.3322/11+0.3200/11+0.2926/11+0.3323/11+0.3094/11+0.3185/11+0.3168/11+0.3261/11+0.2923/11+0.2849/11+0.3107/11+0.3043/11)/20 ≈ 0.02822ms
                    (0.3742/11+0.3191/11+0.2873/11+0.2962/11+0.3410/11+0.2911/11+0.3319/11+0.2845/11+0.3574/11+0.3578/11+0.3241/11+0.3097/11+0.3087/11+0.3098/11+0.2826/11+0.3018/11+0.3322/11+0.3013/11+0.2931/11+0.3529/11)/20 ≈ 0.02889ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (188/11+173/11+177/11+170/11+184/11+143/11+156/11+179/11+186/11+175/11+189/11+174/11+177/11+145/11+164/11+165/11+168/11+180/11+182/11+163/11)/20 ≈ 15.6273ms
                    (169/11+172/11+155/11+152/11+159/11+156/11+156/11+162/11+154/11+158/11+178/11+151/11+190/11+184/11+188/11+159/11+141/11+182/11+157/11+168/11)/20 ≈ 14.9591ms
                </td>
            </tr>
        </tbody>
    </table>
</div>

<h3 id="对比测试4"><a href="#对比测试4" class="headerlink" title="对比测试4"></a>对比测试4</h3><div class="custom-table-container">
    <table class="custom-table">
        <thead>
            <tr>
                <th>分类</th>
                <th>线程数</th>
                <th>分步制作流程</th>
                <th>静态存储</th>
                <th>中间处理逻辑</th>
                <th>静态存储结构</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td rowspan="3" class="custom-table-category">测试1</td>
                <td>3</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>Dictionary&ltType,ConstructorInfo&gt</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.1215/3+0.1344/3+0.1269/3+0.1191/3+0.1397/3+0.1207/3+0.1321/3+0.1596/3+0.1268/3+0.1240/3+0.1192/3+0.1367/3+0.1434/3+0.1453/3+0.1234/3+0.1206/3+0.1297/3+0.1248/3+0.1258/3+0.1314/3)/20 ≈ 0.04342ms
                    (0.1167/3+0.1567/3+0.1168/3+0.1229/3+0.1276/3+0.1203/3+0.1504/3+0.1361/3+0.1232/3+0.1164/3+0.1346/3+0.1202/3+0.1226/3+0.1187/3+0.1164/3+0.1174/3+0.1163/3+0.1665/3+0.1142/3+0.1581/3)/20 ≈ 0.04287ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (11/1+12/1+11/1+13/1+11/1+12/1+13/1+12/1+12/1+12/1+12/1+12/1+12/1+13/1+14/1+12/1+12/1+11/1+13/1+12/1)/20 ≈ 12.1ms
                    (11/1+13/1+12/1+13/1+12/1+11/1+14/1+12/1+13/1+13/1+12/1+12/1+13/1+12/1+11/1+12/1+12/1+12/1+12/1+12/1)/20 ≈ 12.2ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试2</td>
                <td>3</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>CustomStructs</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.1171/3+0.1120/3+0.1177/3+0.1102/3+0.1340/3+0.1139/3+0.1075/3+0.1267/3+0.1090/3+0.1290/3+0.1139/3+0.1130/3+0.1081/3+0.1237/3+0.1136/3+0.1240/3+0.1078/3+0.1137/3+0.1110/3+0.1166/3)/20 ≈ 0.03871ms
                    (0.1133/3+0.1141/3+0.1197/3+0.1327/3+0.1143/3+0.1141/3+0.1109/3+0.1117/3+0.1085/3+0.1291/3+0.1203/3+0.1100/3+0.1157/3+0.1129/3+0.1165/3+0.1108/3+0.1321/3+0.1212/3+0.1133/3+0.1364/3)/20 ≈ 0.03929ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (9/1+10/1+8/1+8/1+8/1+8/1+9/1+8/1+8/1+8/1+10/1+8/1+8/1+8/1+8/1+9/1+8/1+8/1+8/1+10/1)/20 ≈ 8.45ms
                    (9/1+8/1+8/1+8/1+8/1+9/1+9/1+8/1+9/1+8/1+9/1+8/1+8/1+8/1+8/1+8/1+8/1+8/1+10/1+8/1)/20 ≈ 8.35ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试3</td>
                <td>6</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>Dictionary&ltType,ConstructorInfo&gt</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.1408/5+0.1424/5+0.1392/5+0.1536/5+0.1501/5+0.1513/5+0.1902/5+0.1561/5+0.1571/5+0.1512/5+0.1577/5+0.1521/5+0.1933/5+0.1562/5+0.1545/5+0.2309/5+0.1452/5+0.1729/5+0.1595/5+0.1806/5)/20 ≈ 0.03235ms
                    (0.1523/5+0.2164/5+0.1717/5+0.1557/5+0.1463/5+0.1508/5+0.2573/5+0.1511/5+0.1788/5+0.1499/5+0.1659/5+0.1429/5+0.1838/5+0.1626/5+0.1680/5+0.1509/5+0.1619/5+0.2484/5+0.1864/5+0.1531/5)/20 ≈ 0.03454ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (86/5+67/5+65/5+69/5+69/5+65/5+65/5+73/5+80/5+71/5+76/5+64/5+78/5+79/5+65/5+66/5+71/5+66/5+54/5+64/5)/20 ≈ 13.9300ms
                    (69/5+61/5+52/5+93/5+68/5+84/5+74/5+52/5+58/5+48/5+67/5+79/5+84/5+65/5+74/5+64/5+71/5+61/5+71/5+53/5)/20 ≈ 13.4800ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试4</td>
                <td>6</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>CustomStructs</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.1691/5+0.1360/5+0.1559/5+0.1489/5+0.1477/5+0.1709/5+0.1923/5+0.1363/5+0.1661/5+0.1486/5+0.1630/5+0.1409/5+0.1532/5+0.1470/5+0.1795/5+0.1560/5+0.1339/5+0.1381/5+0.1430/5+0.2145/5)/20 ≈ 0.03141ms
                    (0.1588/5+0.1674/5+0.1497/5+0.1568/5+0.1681/5+0.1862/5+0.2099/5+0.1593/5+0.1454/5+0.1556/5+0.1401/5+0.1533/5+0.1433/5+0.1544/5+0.1479/5+0.1357/5+0.1419/5+0.1729/5+0.1588/5+0.1924/5)/20 ≈ 0.03198ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (50/5+40/5+33/5+45/5+44/5+46/5+42/5+52/5+46/5+59/5+50/5+52/5+54/5+46/5+64/5+43/5+67/5+39/5+46/5+32/5)/20 ≈ 9.5000ms
                    (54/5+46/5+38/5+50/5+47/5+48/5+43/5+34/5+45/5+53/5+48/5+55/5+54/5+42/5+44/5+46/5+45/5+49/5+41/5+40/5)/20 ≈ 9.2200ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试5</td>
                <td>12</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>Dictionary&ltType,ConstructorInfo&gt</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.2390/11+0.2359/11+0.2520/11+0.2482/11+0.2405/11+0.2176/11+0.2601/11+0.2245/11+0.2787/11+0.2277/11+0.2312/11+0.2577/11+0.3282/11+0.2152/11+0.2254/11+0.2216/11+0.2292/11+0.2399/11+0.2948/11+0.2497/11)/20 ≈ 0.02235ms
                    (0.2633/11+0.2718/11+0.2210/11+0.2463/11+0.2688/11+0.2250/11+0.3660/11+0.2305/11+0.2052/11+0.2100/11+0.2185/11+0.2774/11+0.2096/11+0.2819/11+0.2111/11+0.2004/11+0.2871/11+0.3690/11+0.2612/11+0.2124/11)/20 ≈ 0.02289ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (199/11+219/11+183/11+211/11+203/11+199/11+197/11+219/11+207/11+203/11+215/11+188/11+215/11+227/11+223/11+227/11+221/11+192/11+194/11+197/11)/20 ≈ 18.8136ms
                    (215/11+222/11+191/11+189/11+207/11+195/11+220/11+194/11+186/11+196/11+193/11+196/11+193/11+196/11+190/11+208/11+214/11+208/11+194/11+208/11)/20 ≈ 18.2500ms
                </td>
            </tr>
            <tr>
                <td rowspan="3" class="custom-table-category">测试6</td>
                <td>12</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td class="custom-table-cross">√</td>
                <td>CustomStructs</td>
            </tr>
            <tr>
                <td class="custom-table-subheader">单线程</td>
                <td colspan="4" class="custom-table-formula">
                    (0.2403/11+0.2195/11+0.1903/11+0.2078/11+0.1840/11+0.1850/11+0.1917/11+0.1984/11+0.1956/11+0.2035/11+0.2081/11+0.2137/11+0.2075/11+0.1892/11+0.2015/11+0.1949/11+0.2776/11+0.2533/11+0.2090/11+0.2211/11)/20 ≈ 0.01905ms
                    (0.1960/11+0.2208/11+0.2386/11+0.2135/11+0.2000/11+0.1977/11+0.2291/11+0.2151/11+0.1998/11+0.1880/11+0.1861/11+0.2405/11+0.2101/11+0.1898/11+0.1945/11+0.2161/11+0.2081/11+0.2079/11+0.2975/11+0.2431/11)/20 ≈ 0.01951ms
                </td>
            </tr>
            <tr>
                <td class="custom-table-subheader">多线程并发</td>
                <td colspan="4" class="custom-table-formula">
                    (178/11+152/11+159/11+126/11+176/11+126/11+150/11+159/11+160/11+149/11+157/11+152/11+164/11+151/11+171/11+163/11+156/11+178/11+131/11+144/11)/20 ≈ 14.1000ms
                    (142/11+162/11+156/11+157/11+160/11+169/11+144/11+133/11+150/11+120/11+122/11+149/11+120/11+158/11+136/11+125/11+171/11+156/11+135/11+137/11)/20 ≈ 13.1909ms
                </td>
            </tr>
        </tbody>
    </table>
</div>

<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">using</span> System;<br><span class="hljs-keyword">using</span> System.Threading;<br><span class="hljs-keyword">using</span> System.Reflection;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Test2</span><br>&#123;<br>    <span class="hljs-comment">//食物工厂，这是一个泛型工厂，可以生产所有继承了Food类的食物</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title">TestFactory3</span> : <span class="hljs-title">IFactory</span>&lt;<span class="hljs-title">Food</span>&gt;<br>    &#123;<br>        <span class="hljs-comment">//记录该工厂所生产的产品有多少种，如果涉及多个生产线，就需要采用数组</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> typesCount = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-comment">//单例模式，用于获取工厂实例</span><br>        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">TestFactory3</span>()</span> &#123; &#125;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestFactoryHandler</span><br>        &#123;<br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> TestFactory3 instance = <span class="hljs-keyword">new</span> TestFactory3();<br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> TestLine3 testLine = <span class="hljs-keyword">new</span> TestLine3(typesCount);<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TestFactory3 <span class="hljs-title">GetInstance</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> p_typesCount</span>)</span><br>        &#123;<br>            typesCount = p_typesCount;<br>            <span class="hljs-keyword">return</span> TestFactoryHandler.instance;<br>        &#125;<br><br>        <span class="hljs-comment">//生产产品的公开方法，需要告诉生产线所要生产的产品类型</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> Food <span class="hljs-title">Create</span>(<span class="hljs-params">Type p_type</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> TestFactoryHandler.testLine.StartLine(p_type);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//食物生产线，这是一个食物生产线，对于生产过程相同的食物可以用同一个生产线，但是对于生产过程不同的食物应该定义不同的生产线</span><br>    <span class="hljs-comment">//假设我们所要生产的Bread和Biscuit的生产过程相同</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title">TestLine3</span> : <span class="hljs-title">ILine</span>&lt;<span class="hljs-title">Food</span>&gt;<br>    &#123;<br>        <span class="hljs-comment">//记录该生产线所生产的产品有多少种</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> typesCount = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">//自定义静态存储结构CustomStructs</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CustomStructs cis;<br>        <span class="hljs-comment">//访问锁</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> k_getmakeinfo = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> k_createfood = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();<br><br>        <span class="hljs-comment">//用构造函数进行初始化</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestLine3</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> p_typesCount</span>)</span><br>        &#123;<br>            typesCount = p_typesCount;<br>            cis = <span class="hljs-keyword">new</span> CustomStructs(typesCount);<br>        &#125;<br><br>        <span class="hljs-comment">//启动生产过程的方法，其中包括了所有生产过程的调用以及调用条件</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> Food <span class="hljs-title">StartLine</span>(<span class="hljs-params">Type p_type</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">lock</span> (k_getmakeinfo)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (!GetMakeInfo(p_type)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>            <span class="hljs-keyword">lock</span> (k_createfood)<br>            &#123;<br>                <span class="hljs-keyword">return</span> MakeFood(p_type);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">//具体的生产过程之一，获取生产资料和食物原料（中间处理逻辑）</span><br>        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">GetMakeInfo</span>(<span class="hljs-params">Type p_type</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (!cis.Contains(p_type))<br>            &#123;<br>                ConstructorInfo ci = p_type.GetConstructor(<span class="hljs-keyword">new</span> Type[<span class="hljs-number">0</span>]);<br>                <span class="hljs-keyword">if</span> (ci == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    cis.Add(p_type, ci);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//具体的生产过程之一，制作食物</span><br>        <span class="hljs-function"><span class="hljs-keyword">private</span> Food <span class="hljs-title">MakeFood</span>(<span class="hljs-params">Type p_type</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">return</span> (Food)cis[p_type].Invoke(<span class="hljs-literal">null</span>);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">//食物之一，Bread</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title">TestBread</span> : <span class="hljs-title">Food</span><br>    &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Eat</span>()</span><br>        &#123;<br>            Console.WriteLine(<span class="hljs-string">&quot;The bread tastes delicious.&quot;</span>);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">//食物之一，Biscuit</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title">TestBiscuit</span> : <span class="hljs-title">Food</span><br>    &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Eat</span>()</span><br>        &#123;<br>            Console.WriteLine(<span class="hljs-string">&quot;The biscuit tastes delicious.&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//工厂接口，所有工厂都需要实现这个接口</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IFactory</span>&lt;<span class="hljs-title">T</span>&gt;<br>    &#123;<br>       <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">Create</span>(<span class="hljs-params">Type p_type</span>)</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//生产线接口，所有生产线都需要实现这个接口</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ILine</span>&lt;<span class="hljs-title">T</span>&gt;<br>    &#123;<br>       <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">StartLine</span>(<span class="hljs-params">Type p_type</span>)</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//食物抽象类，所有食物需要继承该类</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Food</span><br>    &#123;<br>       <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Eat</span>()</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//自定义静态存储结构</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomStruct</span><br>    &#123;<br>        <span class="hljs-keyword">public</span> Type type;<br>        <span class="hljs-keyword">public</span> ConstructorInfo ci;<br>    &#125;<br>    <br>    <span class="hljs-comment">//自定义静态存储结构</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomStructs</span><br>    &#123;<br>        <span class="hljs-keyword">private</span> CustomStruct[] cis;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> capacity &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> count &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; &#125;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomStructs</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> p_capacity</span>)</span><br>        &#123;<br>            capacity = p_capacity;<br>            cis = <span class="hljs-keyword">new</span> CustomStruct[p_capacity];<br>            count = <span class="hljs-number">0</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//重写索引器，可以直接通过Type下标访问</span><br>        <span class="hljs-keyword">public</span> ConstructorInfo <span class="hljs-keyword">this</span>[Type type]<br>        &#123;<br>            <span class="hljs-keyword">get</span><br>            &#123;<br>                <span class="hljs-keyword">if</span> (capacity == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">foreach</span> (CustomStruct item <span class="hljs-keyword">in</span> cis)<br>                &#123;<br>                    <span class="hljs-keyword">if</span> (item.type.Equals(type)) <span class="hljs-keyword">return</span> item.ci;<br>                &#125;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>            <span class="hljs-keyword">set</span><br>            &#123;<br>                <span class="hljs-keyword">foreach</span> (CustomStruct item <span class="hljs-keyword">in</span> cis)<br>                &#123;<br>                    <span class="hljs-keyword">if</span> (item.type.Equals(type))<br>                    &#123;<br>                        item.ci = <span class="hljs-keyword">value</span>;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">//添加元素</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Add</span>(<span class="hljs-params">Type p_type, ConstructorInfo p_ci</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (capacity != <span class="hljs-number">0</span> &amp;&amp; count &lt; capacity)<br>            &#123;<br>                cis[count] = <span class="hljs-keyword">new</span> CustomStruct();<br>                cis[count].type = p_type;<br>                cis[count].ci = p_ci;<br>                count++;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">//检测是否包含对应Type类型元素</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Contains</span>(<span class="hljs-params">Type p_type</span>)</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">foreach</span> (CustomStruct item <span class="hljs-keyword">in</span> cis)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (item == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>                <span class="hljs-keyword">if</span> (item.type.Equals(p_type)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//测试代码</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Test</span><br>    &#123;<br>        <span class="hljs-comment">//所生产的产品类型，我们这里有Bread和Biscuit</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Type[] types = &#123; <span class="hljs-keyword">typeof</span>(TestBread), <span class="hljs-keyword">typeof</span>(TestBiscuit) &#125;;<br><br>        <span class="hljs-comment">//单例模式结合工厂模式，获取工厂，并且需要告诉工厂当前需要生产多少种产品</span><br>        <span class="hljs-keyword">private</span> IFactory&lt;Food&gt; factory = TestFactory3.GetInstance(types.Length);<br><br>        <span class="hljs-comment">//用于记录运行至当前线程总耗时的变量</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> sum = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Test</span>()</span><br>        &#123;<br>            Thread t1 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">0</span>]);<br>                DateTime endTime = DateTime.Now;<br>            &#125;);<br>            t1.Name = <span class="hljs-string">&quot;t1&quot;</span>;<br>            Thread t2 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">1</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t2.Name = <span class="hljs-string">&quot;t2&quot;</span>;<br>            Thread t3 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">0</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t3.Name = <span class="hljs-string">&quot;t3&quot;</span>;<br>            Thread t4 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">1</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t4.Name = <span class="hljs-string">&quot;t4&quot;</span>;<br>            Thread t5 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">0</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t5.Name = <span class="hljs-string">&quot;t5&quot;</span>;<br>            Thread t6 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">1</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t6.Name = <span class="hljs-string">&quot;t6&quot;</span>;<br>            Thread t7 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">0</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t7.Name = <span class="hljs-string">&quot;t7&quot;</span>;<br>            Thread t8 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">1</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t8.Name = <span class="hljs-string">&quot;t8&quot;</span>;<br>            Thread t9 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">0</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t9.Name = <span class="hljs-string">&quot;t9&quot;</span>;<br>            Thread t10 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">1</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t10.Name = <span class="hljs-string">&quot;t10&quot;</span>;<br>            Thread t11 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">0</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t11.Name = <span class="hljs-string">&quot;t11&quot;</span>;<br>            Thread t12 = <span class="hljs-keyword">new</span> Thread(() =&gt;<br>            &#123;<br>                DateTime beginTime = DateTime.Now;<br>                <span class="hljs-keyword">var</span> food = factory.Create(types[<span class="hljs-number">1</span>]);<br>                DateTime endTime = DateTime.Now;<br>                sum += endTime.Subtract(beginTime).TotalMilliseconds;<br>                Console.WriteLine(<span class="hljs-string">&quot;sum:&quot;</span> + sum);<br>            &#125;);<br>            t12.Name = <span class="hljs-string">&quot;t12&quot;</span>;<br>            t1.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t2.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t3.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t4.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t5.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t6.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t7.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t8.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t9.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t10.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t11.Start();<br>            <span class="hljs-comment">// Thread.Sleep(100);</span><br>            t12.Start();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>TestFactory3是我们的食物工厂，创建工厂时需要告诉工厂我们需要生产几种食物，我们要生产TestBread和TestBiscuit两种食物，按照实际情况Bread和Biscuit的生产过程是存在差异的，正常生产中通常也是两条生产线分别进行生产，这里为了简单我们就只建立一条生产线TestLine3，我们假设这个生产线能够生产这两种食物。我们直接调用Factory的Create的方法，并且传递一个Type类型参数，告诉工厂我们要生产什么类型的食物，而我们的工厂通过StartLine方法告诉生产线要生产什么类型的食物。我们这里对食物生产过程进行了简化，分为GetMakeInfo和MakeFood两个过程，并且我们要求二者按照顺序有序分步执行，这就是分步制作流程的体现。GetMakeInfo也就是获取泛型信息的过程，因为我们使用了静态存储，并且我们使用了自定义的静态存储结构CustomStructs，我们先检查静态存储结构中是否存在我们要生产的食物的信息，如果不存在则添加，然后进行下一步MakeFood操作，实际上这个操作我们依旧是调用反射创建对象。本次实验主要做出的改进就是将调用反射创建对象前反复获取反射信息的过程进行了静态化存储，同时针对多线程采用了分步制作流程来提升效率。结合我们的示例来说就是，我们这次生产了Bread和Biscuit两种食物并且对这两种食物的信息进行静态化存储，下一次如果需要再次生产这两种食物之一，则只需要从静态存储结构中获取即可，这就避免了重复通过反射获取反射信息的问题，其次，我们可能存在多个线程访问工厂生产食物，首先我们这里把食物的生产流程分为获取生产资料和制作两个过程，每个线程生产食物都需要经过这两个过程，多线程访问就必然存在资源访问冲突的问题，所以我们对食物生产的这两个过程分别加上了不同的访问锁。这里就有一个疑问了，我们完全可以只使用一个访问锁，让每个线程一次性完成所有生产流程把食物生产出来后再释放访问锁，为什么要给每个生产过程都加上不同的访问锁呢？如果我们这么做就会导致一个资源浪费的问题，第一个线程获取了生产资料，接下来要制作食物，那么这个时候获取生产资料这个过程就空闲了，我们完全可以让其它线程进入这个过程同样来获取生产资料，而不是所有线程都等着第一个线程完全把食物生产出来，所以我们可以让每个生产过程都可以被独立访问，而不是让所有生产过程捆绑在一起，这样就可以进一步缓解资源浪费的问题。当然本次实验中由于我们仅仅把生产过程分为了两个过程，所以没有很好体现出分步制作流程的优势，在后续实验中，我会做出进一步改进，本次实验存在诸多不足，希望有大佬能够不吝赐教和作出指正，谢谢。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://jokevallen.github.io">我与岁月的森林</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://jokevallen.github.io/posts/2026/01/07/b4c212814a45/">https://jokevallen.github.io/posts/2026/01/07/b4c212814a45/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://jokevallen.github.io" target="_blank">我与岁月的森林的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CSharp/">C#</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/2026/01/07/c35991d0e754/" title="Prototype Pattern（原型模式）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Prototype Pattern（原型模式）</div></div><div class="info-2"><div class="info-item-1">简介原型模式是一种创建型设计模式，用于通过克隆原型对象来创建对象，克隆对象作为原型对象的副本，并以原型对象的状态作为初始状态，可以考虑对创建过程复杂或初始化的字段属性繁多的对象应用原型模式，用以简化创建过程。 应用场景创建成本较高的对象、动态配置的对象、数据库连接池、图形化编辑器和框架中的Bean对象管理等。 结构抽象原型（Prototype）： 定义了一个克隆自身的接口，声明了一个clone方法。 具体原型（ConcretePrototype）： 实现抽象原型接口的具体类，负责实现clone方法来复制自身。 客户端（Client）： 使用原型对象的客户端代码，在需要创建新对象时，通过克隆原型对象而不是直接实例化来得到新对象。 原型管理器（Prototype Manager）： 用于注册和管理原型对象的类，提供根据键值获取原型对象的方法。 原理 客户端通过原型管理器获取原型对象的克隆，而不是通过直接实例化新对象。  原型管理器负责注册和存储原型对象，并提供获取原型对象的方法。  具体原型类实现了抽象原型接口，包含一个clone方法，该方法通过复制自身来创建新对象。  客户端代码调...</div></div></div></a><a class="pagination-related" href="/posts/2026/01/07/f5b715c04de7/" title="Memento Pattern（备忘录模式、存档点模式）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Memento Pattern（备忘录模式、存档点模式）</div></div><div class="info-2"><div class="info-item-1">简介备忘录模式是一种行为型设计模式，它允许对象在不暴露其内部状态的情况下捕获和恢复其状态。该模式通常用于实现撤销机制。 应用场景文本编辑器的撤销功能、图形设计工具的历史记录、数据库事务管理、游戏状态管理、配置管理、日历应用的日程记录和命令模式的辅助等。 结构发起人（Originator）： 负责创建一个包含当前状态的备忘录对象，并可以使用备忘录对象恢复其状态。 备忘录（Memento）： 用于存储发起人对象的内部状态。备忘录对象提供一种机制，允许发起人将其状态恢复到先前的状态。 管理者（Caretaker）： 负责保存备忘录对象。管理者可以保存多个备忘录对象，但通常仅在需要的情况下保存最新的状态。 原理 创建备忘录： 发起人创建一个备忘录对象，并将其状态设置为当前状态。  存储备忘录： 管理者将备忘录对象保存起来。通常，管理者保存一个备忘录对象，但也可以保存多个以实现多次撤销的功能。  恢复状态： 当需要恢复到先前的状态时，发起人从管理者那里获取相应的备忘录对象，并将其状态恢复。   代码 ​提示：可在本栏目的资源篇“设计模式代码示例合集”下载所有完整代码资源。  文本备忘录对象...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/2026/01/06/ba4d32539afa/" title="尝试自主打造一个有限状态机（二）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-06</div><div class="info-item-2">尝试自主打造一个有限状态机（二）</div></div><div class="info-2"><div class="info-item-1"> 本系列文章要求读者具备一定的C#编程基础，同时对接口和抽象类、继承关系、设计模式以及面向对象等知识有所了解，在文章中我会对这些知识进行简要的阐述，对于描述有误的地方敬请指正。  前言上一篇文章我们从理论角度去探索了状态机的定义、组成、作用以及设计，对状态机有了一个基本的认识，这么做有利于我们更好地去分析基于实际应用的状态机，以及在自主设计状态机时也能更加地有条不紊。本篇文章将从状态机的实际应用出发，分析基于角色控制的状态机是如何进行设计的。 基于角色控制的状态机定义基于角色控制的状态机是用于管理一个角色的状态的，在动作类游戏中角色的状态往往比较多，并且状态之间的过渡关系也比较繁杂，那么我们就可以为此打造一个状态机来更好地开发和维护这个部分。 从Unity3D的Animator去分析，首先一个角色通常是通过一个.controller文件来管理角色的状态的，这个. controller文件就像一个系统，从Animator的界面可以看到这个系统中包括了定义的状态、状态之间的连接以及状态过渡的条件参数等，而每个状态和状态之间的连接都有一些属性可以进行设置，由于状态机的应用不仅限于像An...</div></div></div></a><a class="pagination-related" href="/posts/2026/01/01/7bac37c2e8d2/" title="游戏中的对象池技术探索（一）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-01</div><div class="info-item-2">游戏中的对象池技术探索（一）</div></div><div class="info-2"><div class="info-item-1">前言对象池技术在游戏开发中的应用非常普遍，它是一种高效管理对象实例的技术，能够避免频繁和重复创建对象所带来的性能开销。本篇文章我们就来探索一下如何在游戏开发中设计通用对象池，使之易于使用和扩展。 代码代码目录结构 ObjectPool Base Interface Settings    ObjectPool作为本模块的根目录，用于存储模块子目录和具体的对象池脚本。Base目录用于存储对象池抽象基类，用于规范对象池的设计。Interface目录用于存储对象池相关的接口，用于未来扩展。Settings目录用于存储创建对象池的参数脚本以及对象池的设置。 Base目录BasePool.cs 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103...</div></div></div></a><a class="pagination-related" href="/posts/2026/01/02/43ee105b7dff/" title="继承实现单例模式的探索（一）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-02</div><div class="info-item-2">继承实现单例模式的探索（一）</div></div><div class="info-2"><div class="info-item-1">前言之前看到朋友采用继承的方式来实现单例模式，觉得很厉害，随后自己去探索了一番，以前实现单例模式都是把代码内联到具体的类中，这使得工程中每次需要使用单例模式时，都采用拷贝的方式，增加了很多冗余代码，并且难以规范单例的统一标准，使得代码不方便扩展和管理。这次探索找到了一种实现方式，先记录下来，后续如果有其它方式再发表系列文章，示例代码为C#。 代码v1.0123456789101112131415161718192021222324using System;/// &lt;summary&gt;/// 单例模式基类/// &lt;/summary&gt;/// &lt;typeparam name=&quot;T&quot;&gt;单例类型&lt;/typeparam&gt;public abstract class Singleton&lt;T&gt;where T : class, new()&#123;    public static T instance =&gt; _instance.Value;    static bool _unlock;    static re...</div></div></div></a><a class="pagination-related" href="/posts/2026/01/01/53c1f0831838/" title="字段临时缓存包装器"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-01</div><div class="info-item-2">字段临时缓存包装器</div></div><div class="info-2"><div class="info-item-1">前言在实际开发中，我们有时候存在一种需求，例如对于某个字段，我们希望在某个明确的保存节点前对字段的修改都仅作为缓存保留，最终是否应用这些修改取决于某些条件，比如玩家对游戏设置的修改可能需要玩家明确确认应用修改后才会保存下来，在此之前玩家在游戏界面上的所有修改都是临时的。 本文基于这个需求探索出了一种解决方案——“临时缓存包装器”，通过创建字段或用于存储字段临时数据的数据结构的副本来实现临时缓存，虽然我们同样可以采用直接声明一个同类型的新字段的方式来达到同样的目的，但是这可能会增加冗余代码，且不利于代码的维护，通过包装器来封装临时缓存的通用逻辑，从而与具体业务逻辑进行隔离。 简介：该类的开发目的是用于给指定类型的源字段创建副本并将其作为源字段的临时缓存，通过该包装器对副本进行一系列的修改，调用者可以在任何需要的时候从该包装器中读取到新的修改，也可以通过解包的方法将副本数据同步到源字段。 具体功能：  创建包装器的方式包括二进制包装、JSON包装和自定义创建，分别对应三个静态方法。 解包方式分为二进制解包和JSON解包，分别对应两个实例方法。 1.2版本开始仅提供一个基本属性——缓存...</div></div></div></a><a class="pagination-related" href="/posts/2026/01/02/caf47d1ddda7/" title="Windows传统DOS路径有效性检测（资源篇）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-02</div><div class="info-item-2">Windows传统DOS路径有效性检测（资源篇）</div></div><div class="info-2"><div class="info-item-1">前言本篇旨在探索Windows传统DOS路径有效性检测的一种可行方案，实际上许多Windows文件IO相关的API也同样可以作为一种方案，为了锻炼一下我们的思考和解决问题的能力，所以我们需要另辟蹊径。本篇将通过有限自动机来验证路径有效性，仅记录资源，具体的实现原理将在后续篇幅中进行详细探讨。具体的文档说明、使用方式和API等都在资源中。 资源下载GitHub 百度网盘（提取码：1314）  免责声明：由于本文内容未经过正规和严格的测试，可能存在错误，因此造成的损失均由使用者自行承担，对本文内容复制、下载、参考等引用行为即默认悉知并同意该声明。  </div></div></div></a><a class="pagination-related" href="/posts/2026/01/05/010562a4b276/" title="C#实现本地服务器客户端私聊通信"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-05</div><div class="info-item-2">C#实现本地服务器客户端私聊通信</div></div><div class="info-2"><div class="info-item-1">前言在游戏中我们经常能够看到玩家与玩家之间可以进行私聊，在QQ或微信中最基本的功能就是用户与用户之间的通信。抽象成计算机网络，就是两个客户端通过服务器进行私聊通信，两个客户端可以互相看到对方发送过来的信息。这种两个客户端的私聊通信是如何实现的呢？在本篇文章我们就来探讨一下。 解决思路这个需求的重点部分在于网络通信，需要我们掌握基本的计算机网络通信知识，具体到每种编程语言又有对应的API。如果把这个需求抽象到计算机网络中，我们就可以理解成两个客户端向服务器发送信息，服务器接收信息后又把信息发送给另一个客户端。这样，一个客户端就可以接收到另一个客户端发送的信息了。 设计思路服务器基于本地服务器开发，通过一个单独的C#控制台项目模拟，编程语言使用C#，客户端通过Unity3D构建GUI并编写客户端脚本。两个客户端则通过打开两个Unity3D项目的可执行文件进行模拟，客户端的GUI需要有调试面板、客户端名称下拉菜单、连接和断开连接按钮、消息显示面板、消息输入框和消息发送按钮等。 代码由于代码中引用了自定义的网络通信共享库NetShare，关于NetShare请阅读本栏目下的“C#实现网络...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/head.png" onerror="this.onerror=null;this.src='/images/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">我与岁月的森林</div><div class="author-info-description">用于记录技术、生活和感想</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">108</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Welcome to my blog.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%A3%B0%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">实验声明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AF%E8%AF%AD"><span class="toc-number">1.1.</span> <span class="toc-text">术语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">1.2.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">计算方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E3%80%81%E5%88%86%E6%9E%90%E5%8F%8A%E7%BB%93%E6%9E%9C"><span class="toc-number">2.</span> <span class="toc-text">实验过程、分析及结果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF1"><span class="toc-number">2.1.</span> <span class="toc-text">思路1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF2"><span class="toc-number">2.2.</span> <span class="toc-text">思路2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93"><span class="toc-number">3.</span> <span class="toc-text">实验总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%B6%B3%E4%B9%8B%E5%A4%84"><span class="toc-number">3.1.</span> <span class="toc-text">不足之处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UML%E5%9B%BE"><span class="toc-number">3.2.</span> <span class="toc-text">UML图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E6%95%B0%E6%8D%AE"><span class="toc-number">4.</span> <span class="toc-text">实验数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.</span> <span class="toc-text">对比测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%952"><span class="toc-number">4.2.</span> <span class="toc-text">对比测试2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.</span> <span class="toc-text">简单测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%953"><span class="toc-number">4.4.</span> <span class="toc-text">对比测试3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%954"><span class="toc-number">4.5.</span> <span class="toc-text">对比测试4</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">5.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2026/01/08/920dce676ecd/" title="【小巧-轻便-实用】ICO图标转换工具">【小巧-轻便-实用】ICO图标转换工具</a><time datetime="2026-01-08T15:23:01.000Z" title="发表于 2026-01-08 23:23:01">2026-01-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2026/01/08/c8d5f22e46c1/" title="Unity配置SQLite以及遇到的问题">Unity配置SQLite以及遇到的问题</a><time datetime="2026-01-08T15:10:24.000Z" title="发表于 2026-01-08 23:10:24">2026-01-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2026/01/08/8f1c257e547b/" title="Unity预览或注释中文乱码解决办法">Unity预览或注释中文乱码解决办法</a><time datetime="2026-01-08T14:59:57.000Z" title="发表于 2026-01-08 22:59:57">2026-01-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2026/01/08/a1958eb9f58b/" title="C#理解回调函数">C#理解回调函数</a><time datetime="2026-01-08T14:55:49.000Z" title="发表于 2026-01-08 22:55:49">2026-01-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2026/01/08/2c47e155b663/" title="Unity中EditorWindow的创建和停靠">Unity中EditorWindow的创建和停靠</a><time datetime="2026-01-08T14:45:35.000Z" title="发表于 2026-01-08 22:45:35">2026-01-08</time></div></div></div></div></div></div></main><footer id="footer" style="background: black;"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By 我与岁月的森林</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: 'Ov23liFAMlBgIqzdY4Or',
      clientSecret: '532ac8cf9ac326fb9e1be267d08c05043fd3bdb7',
      repo: 'JokeVallen.github.io',
      owner: 'JokeVallen',
      admin: ['JokeVallen'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || '210d836ae2c641939ec15abf2dc01b70'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !true) {
    if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script src="/js/LogoAdapter.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>